/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
    id "com.jfrog.bintray" version "1.8.5"
}

repositories {
    mavenLocal()
    jcenter()
    maven {
        url = 'http://repo.maven.apache.org/maven2'
    }
}

dependencies {
    compile 'io.swagger:swagger-annotations:1.5.18'
    compile 'com.google.code.findbugs:jsr305:3.0.2'
    compile 'org.springframework.cloud:spring-cloud-starter-openfeign:2.0.1.RELEASE'
    compile 'org.springframework.cloud:spring-cloud-starter-oauth2:2.0.0.RELEASE'
    compile 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.9.6'
    compile 'org.openapitools:jackson-databind-nullable:0.1.0'
    compile 'org.hibernate.validator:hibernate-validator:6.0.16.Final'
    testCompile 'org.springframework.boot:spring-boot-starter-test:2.0.5.RELEASE'
}

group = '{{cookiecutter.group_id}}'
version = '{{cookiecutter.artifact_version}}'
description = '{{cookiecutter.description}}'
sourceCompatibility = '1.8'

def gitRepo = "https://github.com/hmcts/{{cookiecutter.component_id}}"

def pomConfig = {
    licenses {
        license {
            name "MIT License"
            url "http://www.opensource.org/licenses/mit-license.php"
            distribution "repo"
        }
    }

    scm {
        url gitRepo
    }
}

task sourcesJar(type: Jar, dependsOn: classes) {
    getArchiveClassifier().set('sources')
    from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    getArchiveClassifier().set('javadoc')
    from javadoc.destinationDir
}

publishing {
    publications {
        Main(MavenPublication) {
            from components.java
            artifact sourcesJar
            artifact javadocJar
            groupId project.group
            artifactId '{{cookiecutter.component_id}}'
            version project.version

            pom.withXml {
                def root = asNode()
                root.appendNode('description', '{{cookiecutter.description}}')
                root.appendNode('name', '{{cookiecutter.component_id}}')
                root.appendNode('url', gitRepo)
                root.children().last() + pomConfig
            }
        }
    }
}

bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    publications = ['Main']
    publish = true
    pkg {
        repo = 'hmcts-maven'
        name = '{{cookiecutter.component_id}}'
        userOrg = 'hmcts'
        licenses = ['MIT']
        vcsUrl = gitRepo
        version {
            name = project.version
        }
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
